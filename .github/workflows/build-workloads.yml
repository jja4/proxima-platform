name: Demo Build and Push Workloads

on:
  workflow_dispatch:
    inputs:
      workload:
        description: 'Workload to build (e.g., stellar_optimization)'
        required: true
        default: 'stellar_optimization'

jobs:
  build-workload:
    name: Demo Build Workload Container
    runs-on: ubuntu-latest
    
    strategy:
      matrix:
        workload: [stellar_optimization]
    
    steps:
    - uses: actions/checkout@v4

    # Demo: skipping GCP authentication
    #- name: Authenticate to Google Cloud
    #  uses: google-github-actions/auth@v2
    #  with:
    #    credentials_json: ${{ secrets.GCP_SA_KEY }}

    # Demo: skipping gcloud setup
    #- name: Set up Cloud SDK
    #  uses: google-github-actions/setup-gcloud@v2

    - name: Build Docker image locally
      run: |
        cd docs/examples/${{ matrix.workload }}
        docker build -t demo-${{ matrix.workload }}:latest .
    
    - name: Tag Docker image
      run: |
        docker tag demo-${{ matrix.workload }}:latest demo-${{ matrix.workload }}:demo

    # Demo: skip push, just show what would happen
    - name: Push Docker image (demo)
      run: |
        echo "docker push demo-${{ matrix.workload }}:latest"
        echo "docker push demo-${{ matrix.workload }}:demo"

    - name: Image digest (demo)
      run: |
        echo "Demo image: demo-${{ matrix.workload }}:latest"
