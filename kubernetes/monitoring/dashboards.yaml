apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboards
  namespace: monitoring
  labels:
    grafana_dashboard: "1"
data:
  ray-dashboard.json: |
    {
      "dashboard": {
        "title": "Ray Cluster Overview",
        "panels": [
          {
            "title": "Active Workers",
            "targets": [{
              "expr": "sum(ray_node_cpu_count{node_type='worker'})"
            }],
            "type": "stat"
          },
          {
            "title": "CPU Utilization",
            "targets": [{
              "expr": "100 - (avg by(instance) (rate(node_cpu_seconds_total{mode='idle'}[5m])) * 100)"
            }],
            "type": "graph"
          },
          {
            "title": "Memory Usage",
            "targets": [{
              "expr": "ray_node_mem_used / ray_node_mem_total * 100"
            }],
            "type": "graph"
          },
          {
            "title": "Active Tasks",
            "targets": [{
              "expr": "sum(ray_tasks{State='RUNNING'})"
            }],
            "type": "graph"
          }
        ]
      }
    }
  
  jobs-dashboard.json: |
    {
      "dashboard": {
        "title": "ML Training Jobs",
        "panels": [
          {
            "title": "Running Jobs",
            "targets": [{
              "expr": "count(kube_job_status_active{namespace='jobs'} == 1)"
            }],
            "type": "stat"
          },
          {
            "title": "Job Success Rate (24h)",
            "targets": [{
              "expr": "sum(kube_job_status_succeeded{namespace='jobs'}[24h]) / sum(kube_job_status_succeeded{namespace='jobs'}[24h] + kube_job_status_failed{namespace='jobs'}[24h]) * 100"
            }],
            "type": "gauge"
          },
          {
            "title": "Job Duration",
            "targets": [{
              "expr": "histogram_quantile(0.95, rate(kube_job_complete_duration_seconds_bucket{namespace='jobs'}[5m]))"
            }],
            "type": "graph"
          }
        ]
      }
    }
